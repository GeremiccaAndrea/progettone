{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport * as L from 'leaflet'; // Importa Leaflet\nexport let AppComponent = class AppComponent {\n  constructor(crimesService, router) {\n    this.crimesService = crimesService;\n    this.router = router;\n  }\n  ngOnInit() {\n    this.initMap(); // Carica il file GeoJSON\n  }\n  // Funzione per inizializzare la mappa\n  initMap() {\n    this.map = L.map('map', {\n      center: [41.816813771373916, -87.60670812560372],\n      //center:[45.4642, 9.19],\n      zoom: 14\n    });\n    // Aggiungi il layer di base di OpenStreetMap\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(this.map);\n  }\n  flyToLocation(lat, lng) {\n    this.map.flyTo([lat, lng], 14); // Cambia lo zoom se necessario\n  }\n\n  searchLocation(query) {\n    if (this.geoJsonLayer != null) {\n      this.geoJsonLayer.remove();\n    }\n    this.crimesService.search(query).subscribe(location => {\n      if (location) {\n        console.log(location.name); // Controlla i dati ricevuti\n        this.loadData(location.name);\n        const lat = parseFloat(location.lat);\n        const lon = parseFloat(location.lon);\n        this.flyToLocation(lat, lon);\n      } else {\n        alert('Nessun risultato trovato!');\n      }\n    }, error => {\n      console.error('Errore durante la ricerca:', error);\n      alert('Si è verificato un errore durante la ricerca.');\n    });\n  }\n  onSwitchChange(event) {\n    const isChecked = event.target.checked;\n    if (isChecked) {\n      console.log('chicago e milano');\n    } else {\n      console.log('mappa utenti');\n    }\n  }\n  // Funzione per caricare i dati (crimini e distretti) da un file GeoJSON\n  loadData(namecity) {\n    console.log(namecity);\n    this.crimesService.GetCity(namecity).subscribe(data => {\n      console.log(data);\n      // Assicurati che data sia un FeatureCollection\n      if (data.type === \"FeatureCollection\" && Array.isArray(data.features)) {\n        this.geojsonData = data;\n        this.addDistrictsToMap(data);\n      } else {\n        console.error(\"Formato GeoJSON non valido\", data);\n      }\n    }, error => {\n      console.error('Errore nel recupero dei dati:', error);\n    });\n  }\n  // Funzione per determinare il colore in base al numero di crimini\n  getCrimeColor(crimeCount, data) {\n    console.log(\"inserimento colore\");\n    const maxCrimeCount = Math.max(...data.features.map(f => f.properties.numero_crimini));\n    const verde = maxCrimeCount * 0.25;\n    const giallo = maxCrimeCount * 0.75;\n    let r = 0,\n      g = 0,\n      b = 0;\n    if (crimeCount <= verde) {\n      return `rgb(0,255,0)`;\n    } else if (crimeCount <= giallo) {\n      return `rgb(255,255,0)`;\n    } else {\n      return `rgb(255,0,0)`;\n    }\n  }\n  // Funzione per aggiungere i distretti con il numero di crimini alla mappa\n  addDistrictsToMap(data) {\n    this.geoJsonLayer = L.geoJSON(data, {\n      style: feature => {\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        const color = this.getCrimeColor(crimeCount, data); // Otteniamo il colore in base al numero di crimini\n        return {\n          color: color,\n          weight: 1,\n          opacity: 1 // Border opacity\n        };\n      },\n\n      onEachFeature: (feature, layer) => {\n        // Check for the required properties to avoid undefined errors\n        const neighborhood = feature.properties?.quartiere || \"Unknown\";\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        const city = feature.properties?.citta || \"Unknown\";\n        layer.bindPopup(`\n          <strong>${neighborhood}</strong><br/>\n          Crimini: ${crimeCount}`);\n        layer.on('click', () => {\n          this.crimesService.getDataCrime(city, neighborhood).subscribe(data => {\n            console.log(data);\n            this.crimini = data;\n          });\n        });\n      }\n    }).addTo(this.map); // Aggiungi il layer alla mappa\n  }\n};\n\nAppComponent = __decorate([Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})], AppComponent);","map":{"version":3,"names":["Component","L","AppComponent","constructor","crimesService","router","ngOnInit","initMap","map","center","zoom","tileLayer","attribution","addTo","flyToLocation","lat","lng","flyTo","searchLocation","query","geoJsonLayer","remove","search","subscribe","location","console","log","name","loadData","parseFloat","lon","alert","error","onSwitchChange","event","isChecked","target","checked","namecity","GetCity","data","type","Array","isArray","features","geojsonData","addDistrictsToMap","getCrimeColor","crimeCount","maxCrimeCount","Math","max","f","properties","numero_crimini","verde","giallo","r","g","b","geoJSON","style","feature","color","weight","opacity","onEachFeature","layer","neighborhood","quartiere","city","citta","bindPopup","on","getDataCrime","crimini","__decorate","selector","templateUrl","styleUrls"],"sources":["/workspace/progettone/prove_mappa/src/app/app.component.ts"],"sourcesContent":["\nimport { Component, OnInit } from '@angular/core';\nimport { CrimesService } from './crimes.service';\nimport * as L from 'leaflet';  // Importa Leaflet\nimport { Feature, FeatureCollection } from 'geojson';\nimport { Router } from '@angular/router';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent implements OnInit {\n  geojsonData:any; // Dati GeoJSON che contengono sia la geometria che il numero di crimini\n  geojsonDataMilano:any; \n  crimini: any;\n  formattedData: any;\n  geoJsonLayer:any;\n\n  constructor(private crimesService: CrimesService, private router: Router) { }\n\n  map!: L.Map;\n\n  ngOnInit(): void {\n    this.initMap(); // Carica il file GeoJSON\n  }\n\n  // Funzione per inizializzare la mappa\n  initMap(): void {\n    this.map = L.map('map', {\n      center: [41.816813771373916, -87.60670812560372],  // Coordinate centrali per Chicago\n      //center:[45.4642, 9.19],\n      zoom: 14\n    });\n\n    // Aggiungi il layer di base di OpenStreetMap\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(this.map);\n  }\n  flyToLocation(lat: number, lng: number): void {\n    this.map.flyTo([lat, lng], 14); // Cambia lo zoom se necessario\n  }\n  searchLocation(query: string): void {\n    if (this.geoJsonLayer!= null){\n      this.geoJsonLayer.remove();\n    }\n    this.crimesService.search(query).subscribe(\n      location => {\n        if (location) {\n          console.log(location.name); // Controlla i dati ricevuti\n          this.loadData(location.name)\n          const lat = parseFloat(location.lat);\n          const lon = parseFloat(location.lon);\n          this.flyToLocation(lat, lon);\n        } else {\n          alert('Nessun risultato trovato!');\n        }\n      },\n      error => {\n        console.error('Errore durante la ricerca:', error);\n        alert('Si è verificato un errore durante la ricerca.');\n      }\n    );\n  }\n\n  onSwitchChange(event: Event): void {\n    const isChecked = (event.target as HTMLInputElement).checked;\n    if (isChecked) {\n      console.log('chicago e milano');\n    } else {\n      console.log('mappa utenti');\n    }\n  }\n  \n  // Funzione per caricare i dati (crimini e distretti) da un file GeoJSON\n  loadData(namecity:string): void {\n    console.log(namecity);\n    this.crimesService.GetCity(namecity).subscribe(\n      (data) => {\n        console.log(data);\n        // Assicurati che data sia un FeatureCollection\n      if (data.type === \"FeatureCollection\" && Array.isArray(data.features)) {\n          this.geojsonData = data;\n          this.addDistrictsToMap(data);\n        } else {\n          console.error(\"Formato GeoJSON non valido\", data);\n        }\n      },\n      (error) => {\n        console.error('Errore nel recupero dei dati:', error);\n      }\n    );\n  }\n  // Funzione per determinare il colore in base al numero di crimini\n  getCrimeColor(crimeCount: number,data: any): string {\n    console.log(\"inserimento colore\");\n    const maxCrimeCount = Math.max(...data.features.map((f: any) => f.properties.numero_crimini)); \n    const verde=maxCrimeCount*0.25;\n    const giallo=maxCrimeCount*0.75;\n    let r = 0, g = 0, b = 0;\n    if (crimeCount <= verde) {      \n      return `rgb(0,255,0)`;\n    } else if(crimeCount <= giallo){\n      return `rgb(255,255,0)`;\n    }else{\n      return `rgb(255,0,0)`;\n    }\n  }\n  // Funzione per aggiungere i distretti con il numero di crimini alla mappa\n  addDistrictsToMap(data: any): void {\n  \n    this.geoJsonLayer = L.geoJSON(data, {\n      style: (feature: any) => {\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        const color = this.getCrimeColor(crimeCount,data); // Otteniamo il colore in base al numero di crimini\n        \n        return {\n          color: color,   // Border color\n          weight: 1,       // Border thickness\n          opacity: 1       // Border opacity\n        };\n      },\n      onEachFeature: (feature, layer) => {\n        // Check for the required properties to avoid undefined errors\n        const neighborhood = feature.properties?.quartiere || \"Unknown\";\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        const city= feature.properties?.citta || \"Unknown\";\n        layer.bindPopup(`\n          <strong>${neighborhood}</strong><br/>\n          Crimini: ${crimeCount}`\n        );\n        layer.on('click',()=>\n          {\n          this.crimesService.getDataCrime(city,neighborhood).subscribe(data => {\n            console.log(data);\n            this.crimini = data;\n          });\n        });\n      }\n    }).addTo(this.map); // Aggiungi il layer alla mappa\n  }\n}\n"],"mappings":";AACA,SAASA,SAAS,QAAgB,eAAe;AAEjD,OAAO,KAAKC,CAAC,MAAM,SAAS,CAAC,CAAE;AASxB,WAAMC,YAAY,GAAlB,MAAMA,YAAY;EAOvBC,YAAoBC,aAA4B,EAAUC,MAAc;IAApD,KAAAD,aAAa,GAAbA,aAAa;IAAyB,KAAAC,MAAM,GAANA,MAAM;EAAY;EAI5EC,QAAQA,CAAA;IACN,IAAI,CAACC,OAAO,EAAE,CAAC,CAAC;EAClB;EAEA;EACAA,OAAOA,CAAA;IACL,IAAI,CAACC,GAAG,GAAGP,CAAC,CAACO,GAAG,CAAC,KAAK,EAAE;MACtBC,MAAM,EAAE,CAAC,kBAAkB,EAAE,CAAC,iBAAiB,CAAC;MAChD;MACAC,IAAI,EAAE;KACP,CAAC;IAEF;IACAT,CAAC,CAACU,SAAS,CAAC,oDAAoD,EAAE;MAChEC,WAAW,EAAE;KACd,CAAC,CAACC,KAAK,CAAC,IAAI,CAACL,GAAG,CAAC;EACpB;EACAM,aAAaA,CAACC,GAAW,EAAEC,GAAW;IACpC,IAAI,CAACR,GAAG,CAACS,KAAK,CAAC,CAACF,GAAG,EAAEC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;EAClC;;EACAE,cAAcA,CAACC,KAAa;IAC1B,IAAI,IAAI,CAACC,YAAY,IAAG,IAAI,EAAC;MAC3B,IAAI,CAACA,YAAY,CAACC,MAAM,EAAE;;IAE5B,IAAI,CAACjB,aAAa,CAACkB,MAAM,CAACH,KAAK,CAAC,CAACI,SAAS,CACxCC,QAAQ,IAAG;MACT,IAAIA,QAAQ,EAAE;QACZC,OAAO,CAACC,GAAG,CAACF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAAC;QAC5B,IAAI,CAACC,QAAQ,CAACJ,QAAQ,CAACG,IAAI,CAAC;QAC5B,MAAMZ,GAAG,GAAGc,UAAU,CAACL,QAAQ,CAACT,GAAG,CAAC;QACpC,MAAMe,GAAG,GAAGD,UAAU,CAACL,QAAQ,CAACM,GAAG,CAAC;QACpC,IAAI,CAAChB,aAAa,CAACC,GAAG,EAAEe,GAAG,CAAC;OAC7B,MAAM;QACLC,KAAK,CAAC,2BAA2B,CAAC;;IAEtC,CAAC,EACDC,KAAK,IAAG;MACNP,OAAO,CAACO,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MAClDD,KAAK,CAAC,+CAA+C,CAAC;IACxD,CAAC,CACF;EACH;EAEAE,cAAcA,CAACC,KAAY;IACzB,MAAMC,SAAS,GAAID,KAAK,CAACE,MAA2B,CAACC,OAAO;IAC5D,IAAIF,SAAS,EAAE;MACbV,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;KAChC,MAAM;MACLD,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC;;EAE/B;EAEA;EACAE,QAAQA,CAACU,QAAe;IACtBb,OAAO,CAACC,GAAG,CAACY,QAAQ,CAAC;IACrB,IAAI,CAAClC,aAAa,CAACmC,OAAO,CAACD,QAAQ,CAAC,CAACf,SAAS,CAC3CiB,IAAI,IAAI;MACPf,OAAO,CAACC,GAAG,CAACc,IAAI,CAAC;MACjB;MACF,IAAIA,IAAI,CAACC,IAAI,KAAK,mBAAmB,IAAIC,KAAK,CAACC,OAAO,CAACH,IAAI,CAACI,QAAQ,CAAC,EAAE;QACnE,IAAI,CAACC,WAAW,GAAGL,IAAI;QACvB,IAAI,CAACM,iBAAiB,CAACN,IAAI,CAAC;OAC7B,MAAM;QACLf,OAAO,CAACO,KAAK,CAAC,4BAA4B,EAAEQ,IAAI,CAAC;;IAErD,CAAC,EACAR,KAAK,IAAI;MACRP,OAAO,CAACO,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;IACvD,CAAC,CACF;EACH;EACA;EACAe,aAAaA,CAACC,UAAkB,EAACR,IAAS;IACxCf,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;IACjC,MAAMuB,aAAa,GAAGC,IAAI,CAACC,GAAG,CAAC,GAAGX,IAAI,CAACI,QAAQ,CAACpC,GAAG,CAAE4C,CAAM,IAAKA,CAAC,CAACC,UAAU,CAACC,cAAc,CAAC,CAAC;IAC7F,MAAMC,KAAK,GAACN,aAAa,GAAC,IAAI;IAC9B,MAAMO,MAAM,GAACP,aAAa,GAAC,IAAI;IAC/B,IAAIQ,CAAC,GAAG,CAAC;MAAEC,CAAC,GAAG,CAAC;MAAEC,CAAC,GAAG,CAAC;IACvB,IAAIX,UAAU,IAAIO,KAAK,EAAE;MACvB,OAAO,cAAc;KACtB,MAAM,IAAGP,UAAU,IAAIQ,MAAM,EAAC;MAC7B,OAAO,gBAAgB;KACxB,MAAI;MACH,OAAO,cAAc;;EAEzB;EACA;EACAV,iBAAiBA,CAACN,IAAS;IAEzB,IAAI,CAACpB,YAAY,GAAGnB,CAAC,CAAC2D,OAAO,CAACpB,IAAI,EAAE;MAClCqB,KAAK,EAAGC,OAAY,IAAI;QACtB,MAAMd,UAAU,GAAGc,OAAO,CAACT,UAAU,EAAEC,cAAc,IAAI,CAAC;QAC1D,MAAMS,KAAK,GAAG,IAAI,CAAChB,aAAa,CAACC,UAAU,EAACR,IAAI,CAAC,CAAC,CAAC;QAEnD,OAAO;UACLuB,KAAK,EAAEA,KAAK;UACZC,MAAM,EAAE,CAAC;UACTC,OAAO,EAAE,CAAC,CAAO;SAClB;MACH,CAAC;;MACDC,aAAa,EAAEA,CAACJ,OAAO,EAAEK,KAAK,KAAI;QAChC;QACA,MAAMC,YAAY,GAAGN,OAAO,CAACT,UAAU,EAAEgB,SAAS,IAAI,SAAS;QAC/D,MAAMrB,UAAU,GAAGc,OAAO,CAACT,UAAU,EAAEC,cAAc,IAAI,CAAC;QAC1D,MAAMgB,IAAI,GAAER,OAAO,CAACT,UAAU,EAAEkB,KAAK,IAAI,SAAS;QAClDJ,KAAK,CAACK,SAAS,CAAC;oBACJJ,YAAY;qBACXpB,UAAU,EAAE,CACxB;QACDmB,KAAK,CAACM,EAAE,CAAC,OAAO,EAAC,MAAI;UAEnB,IAAI,CAACrE,aAAa,CAACsE,YAAY,CAACJ,IAAI,EAACF,YAAY,CAAC,CAAC7C,SAAS,CAACiB,IAAI,IAAG;YAClEf,OAAO,CAACC,GAAG,CAACc,IAAI,CAAC;YACjB,IAAI,CAACmC,OAAO,GAAGnC,IAAI;UACrB,CAAC,CAAC;QACJ,CAAC,CAAC;MACJ;KACD,CAAC,CAAC3B,KAAK,CAAC,IAAI,CAACL,GAAG,CAAC,CAAC,CAAC;EACtB;CACD;;AAlIYN,YAAY,GAAA0E,UAAA,EALxB5E,SAAS,CAAC;EACT6E,QAAQ,EAAE,UAAU;EACpBC,WAAW,EAAE,sBAAsB;EACnCC,SAAS,EAAE,CAAC,qBAAqB;CAClC,CAAC,C,EACW7E,YAAY,CAkIxB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}