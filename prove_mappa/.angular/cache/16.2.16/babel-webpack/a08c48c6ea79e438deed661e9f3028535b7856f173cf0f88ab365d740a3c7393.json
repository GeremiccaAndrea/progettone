{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport * as L from 'leaflet'; // Importa Leaflet\nexport let AppComponent = class AppComponent {\n  ngAfterViewInit() {\n    const userInput = document.getElementById(\"userInput\");\n    if (userInput) {\n      userInput.addEventListener(\"keypress\", event => {\n        if (event.key === \"Enter\") {\n          userInput.classList.add(\"fade-out\");\n          const helperText = document.getElementById(\"helperText\");\n          if (helperText) {\n            helperText.classList.add(\"fade-out\");\n          }\n          setTimeout(() => {\n            const initialContainer = document.getElementById(\"initialContainer\");\n            if (initialContainer) {\n              initialContainer.style.display = \"none\";\n            }\n            const mainContent = document.getElementById(\"mainContent\");\n            if (mainContent) {\n              mainContent.style.opacity = \"1\";\n            }\n          }, 5000);\n        }\n      });\n    }\n  }\n  constructor(crimesService, router) {\n    this.crimesService = crimesService;\n    this.router = router;\n  }\n  ngOnInit() {\n    this.initMap(); // Carica il file GeoJSON\n  }\n  // Funzione per inizializzare la mappa\n  initMap() {\n    this.map = L.map('map', {\n      // center: [41.816813771373916, -87.60670812560372],  // Coordinate centrali per Chicago\n      center: [45.4642, 9.19],\n      zoom: 14\n    });\n    // Aggiungi il layer di base di OpenStreetMap\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(this.map);\n  }\n  flyToLocation(lat, lng) {\n    this.map.flyTo([lat, lng], 14); // Cambia lo zoom se necessario\n  }\n\n  searchLocation(query) {\n    if (this.geoJsonLayer != null) {\n      this.geoJsonLayer.remove();\n    }\n    this.crimesService.search(query).subscribe(location => {\n      if (location) {\n        console.log(location.name); // Controlla i dati ricevuti\n        this.loadData(location.name);\n        const lat = parseFloat(location.lat);\n        const lon = parseFloat(location.lon);\n        this.flyToLocation(lat, lon);\n      } else {\n        alert('Nessun risultato trovato!');\n      }\n    }, error => {\n      console.error('Errore durante la ricerca:', error);\n      alert('Si è verificato un errore durante la ricerca.');\n    });\n  }\n  onSwitchChange(event) {\n    const isChecked = event.target.checked;\n    if (isChecked) {\n      console.log('chicago e milano');\n    } else {\n      console.log('mappa utenti');\n    }\n  }\n  // Funzione per caricare i dati (crimini e distretti) da un file GeoJSON\n  loadData(namecity) {\n    console.log(namecity);\n    this.crimesService.GetCity(namecity).subscribe(data => {\n      console.log(data);\n      // Assicurati che data sia un FeatureCollection\n      if (data.type === \"FeatureCollection\" && Array.isArray(data.features)) {\n        this.geojsonData = data;\n        this.addDistrictsToMap(data);\n      } else {\n        console.error(\"Formato GeoJSON non valido\", data);\n      }\n    }, error => {\n      console.error('Errore nel recupero dei dati:', error);\n    });\n  }\n  // Funzione per determinare il colore in base al numero di crimini\n  getCrimeColor(crimeCount, data) {\n    console.log(\"inserimento colore\");\n    const maxCrimeCount = Math.max(...data.features.map(f => f.properties.numero_crimini));\n    const verde = maxCrimeCount * 0.25;\n    const giallo = maxCrimeCount * 0.75;\n    let r = 0,\n      g = 0,\n      b = 0;\n    if (crimeCount <= verde) {\n      return `rgb(0,255,0)`;\n    } else if (crimeCount <= giallo) {\n      return `rgb(255,255,0)`;\n    } else {\n      return `rgb(255,0,0)`;\n    }\n  }\n  // Funzione per aggiungere i distretti con il numero di crimini alla mappa\n  addDistrictsToMap(data) {\n    this.geoJsonLayer = L.geoJSON(data, {\n      style: feature => {\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        const color = this.getCrimeColor(crimeCount, data); // Otteniamo il colore in base al numero di crimini\n        return {\n          color: color,\n          weight: 1,\n          opacity: 1 // Border opacity\n        };\n      },\n\n      onEachFeature: (feature, layer) => {\n        // Check for the required properties to avoid undefined errors\n        const neighborhood = feature.properties?.quartiere || \"Unknown\";\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        layer.bindPopup(`\n          <strong>${neighborhood}</strong><br/>\n          Crimini: ${crimeCount}`);\n      }\n    }).addTo(this.map); // Aggiungi il layer alla mappa\n  }\n};\n\nAppComponent = __decorate([Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})], AppComponent);","map":{"version":3,"names":["Component","L","AppComponent","ngAfterViewInit","userInput","document","getElementById","addEventListener","event","key","classList","add","helperText","setTimeout","initialContainer","style","display","mainContent","opacity","constructor","crimesService","router","ngOnInit","initMap","map","center","zoom","tileLayer","attribution","addTo","flyToLocation","lat","lng","flyTo","searchLocation","query","geoJsonLayer","remove","search","subscribe","location","console","log","name","loadData","parseFloat","lon","alert","error","onSwitchChange","isChecked","target","checked","namecity","GetCity","data","type","Array","isArray","features","geojsonData","addDistrictsToMap","getCrimeColor","crimeCount","maxCrimeCount","Math","max","f","properties","numero_crimini","verde","giallo","r","g","b","geoJSON","feature","color","weight","onEachFeature","layer","neighborhood","quartiere","bindPopup","__decorate","selector","templateUrl","styleUrls"],"sources":["/workspace/progettone/prove_mappa/src/app/app.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { CrimesService } from './crimes.service';\nimport * as L from 'leaflet';  // Importa Leaflet\nimport { Feature, FeatureCollection } from 'geojson';\nimport { Router } from '@angular/router';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent implements OnInit {\n\n  ngAfterViewInit(): void {\n    const userInput = document.getElementById(\"userInput\");\n    if (userInput) {\n      userInput.addEventListener(\"keypress\", (event: KeyboardEvent) => {\n        if (event.key === \"Enter\") {\n          userInput.classList.add(\"fade-out\");\n          const helperText = document.getElementById(\"helperText\");\n          if (helperText) {\n            helperText.classList.add(\"fade-out\");\n          }\n  \n          setTimeout(() => {\n            const initialContainer = document.getElementById(\"initialContainer\");\n            if (initialContainer) {\n              initialContainer.style.display = \"none\";\n            }\n            const mainContent = document.getElementById(\"mainContent\");\n            if (mainContent) {\n              mainContent.style.opacity = \"1\";\n            }\n          }, 5000);\n        }\n      });\n    }}\n  geojsonData:any; // Dati GeoJSON che contengono sia la geometria che il numero di crimini\n  geojsonDataMilano:any; \n  crimini: any;\n  formattedData: any;\n  geoJsonLayer:any;\n\n  constructor(private crimesService: CrimesService, private router: Router) { }\n\n  map!: L.Map;\n\n  ngOnInit(): void {\n    this.initMap(); // Carica il file GeoJSON\n  }\n\n  // Funzione per inizializzare la mappa\n  initMap(): void {\n    this.map = L.map('map', {\n      // center: [41.816813771373916, -87.60670812560372],  // Coordinate centrali per Chicago\n      center:[45.4642, 9.19],\n      zoom: 14\n    });\n\n    // Aggiungi il layer di base di OpenStreetMap\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(this.map);\n  }\n  flyToLocation(lat: number, lng: number): void {\n    this.map.flyTo([lat, lng], 14); // Cambia lo zoom se necessario\n  }\n  searchLocation(query: string): void {\n    if (this.geoJsonLayer!= null){\n      this.geoJsonLayer.remove();\n    }\n    this.crimesService.search(query).subscribe(\n      location => {\n        if (location) {\n          console.log(location.name); // Controlla i dati ricevuti\n          this.loadData(location.name)\n          const lat = parseFloat(location.lat);\n          const lon = parseFloat(location.lon);\n          this.flyToLocation(lat, lon);\n        } else {\n          alert('Nessun risultato trovato!');\n        }\n      },\n      error => {\n        console.error('Errore durante la ricerca:', error);\n        alert('Si è verificato un errore durante la ricerca.');\n      }\n    );\n  }\n\n  onSwitchChange(event: Event): void {\n    const isChecked = (event.target as HTMLInputElement).checked;\n    if (isChecked) {\n      console.log('chicago e milano');\n    } else {\n      console.log('mappa utenti');\n    }\n  }\n  \n  // Funzione per caricare i dati (crimini e distretti) da un file GeoJSON\n  loadData(namecity:string): void {\n    console.log(namecity);\n    this.crimesService.GetCity(namecity).subscribe(\n      (data) => {\n        console.log(data);\n        // Assicurati che data sia un FeatureCollection\n      if (data.type === \"FeatureCollection\" && Array.isArray(data.features)) {\n          this.geojsonData = data;\n          this.addDistrictsToMap(data);\n        } else {\n          console.error(\"Formato GeoJSON non valido\", data);\n        }\n      },\n      (error) => {\n        console.error('Errore nel recupero dei dati:', error);\n      }\n    );\n  }\n  // Funzione per determinare il colore in base al numero di crimini\n  getCrimeColor(crimeCount: number,data: any): string {\n    console.log(\"inserimento colore\");\n    const maxCrimeCount = Math.max(...data.features.map((f: any) => f.properties.numero_crimini)); \n    const verde=maxCrimeCount*0.25;\n    const giallo=maxCrimeCount*0.75;\n    let r = 0, g = 0, b = 0;\n    if (crimeCount <= verde) {      \n      return `rgb(0,255,0)`;\n    } else if(crimeCount <= giallo){\n      return `rgb(255,255,0)`;\n    }else{\n      return `rgb(255,0,0)`;\n    }\n  }\n  // Funzione per aggiungere i distretti con il numero di crimini alla mappa\n  addDistrictsToMap(data: any): void {\n  \n    this.geoJsonLayer = L.geoJSON(data, {\n      style: (feature: any) => {\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        const color = this.getCrimeColor(crimeCount,data); // Otteniamo il colore in base al numero di crimini\n        \n        return {\n          color: color,   // Border color\n          weight: 1,       // Border thickness\n          opacity: 1       // Border opacity\n        };\n      },\n      onEachFeature: (feature, layer) => {\n        // Check for the required properties to avoid undefined errors\n        const neighborhood = feature.properties?.quartiere || \"Unknown\";\n        const crimeCount = feature.properties?.numero_crimini || 0;\n        layer.bindPopup(`\n          <strong>${neighborhood}</strong><br/>\n          Crimini: ${crimeCount}`);\n      }\n    }).addTo(this.map); // Aggiungi il layer alla mappa\n\n\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}